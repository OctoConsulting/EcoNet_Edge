FROM debian:bullseye

RUN apt-get update && apt-get upgrade -y

RUN apt-get update && apt-get install ffmpeg -y
RUN apt-get update && apt-get install procps -y

RUN apt-get update && apt-get install python3 python3-pip -y
RUN apt-get update && apt-get install python3-waitress -y

RUN pip install flask flask_sock flask_sqlalchemy flask_cors
RUN pip install requests

COPY ./index.html /usr/share/nginx/html/

RUN mkdir /usr/share/nginx/html/lib/hls.js
COPY ./lib/hls.js /usr/share/nginx/html/lib/hls.js

COPY ./test_vid.mp4 ./

COPY ./encode_vid.sh .
COPY ./encode_stream.sh .
COPY ./encode_stop.sh .
COPY ./container_startup.sh .
COPY ./controls.py .
COPY ./app.py .

RUN mkdir /srv/feed1/

CMD [ "/bin/bash", "./container_startup.sh" ]